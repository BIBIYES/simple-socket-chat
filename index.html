<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" type="image/png" href="/favicon.png" sizes="16x16">

    <title>Secure Chat</title>

    <!-- Bootstrap core CSS -->
    <!-- <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"> -->
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="https://v3.bootcss.com/assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="https://v3.bootcss.com/examples/sticky-footer/sticky-footer.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <style>
        form input {
            border-style: solid;
            border-color: black;
            padding: 10px;
            width: 80%;
            margin-right: .5%;
        }

        form button {
            width: 18%;
            background: rgb(130, 224, 255);
            /*border: none;*/
            padding: 10px;
        }

        #messages {
            list-style-type: none;
            margin: 0;
            padding: 0;
            word-break: break-all;     /* line break in li items */
            /* max-height:420px;         scrolling the ul list */
            /* overflow:auto;            /* scrolling the ul list */
        }

        #messages li {
            padding: 5px 10px;
        }

        #messages li:nth-child(odd) {
            background: #eee;
        }

        #messages {
            margin-bottom: 100px /*40*/
        }
    </style>
</head>

<body>

    <!-- Begin page content -->
    <div class="container">
        <div class="page-header">
            <h1>畅聊</h1>
        </div>
        <p class="lead">简单，沟通。</p>
        <p>收到的信息:</p>
        <ul id="messages"></ul>
    </div>
    
   <div style="position: absolute; bottom: 55px; width: 100%; background-color: #f5f5f5">
   	<!--; width: auto; max-width: 680px; padding: 0 15px; margin-right: 10%; margin-left: 10%; -->
   	  <div class="container">
        <p>Webs for image sharing: <br>
        	<a href="https://snipboard.io/" target="_blank">snipboard.io</a> , 
        	<a href="https://paste.pics/" target="_blank">paste.pics</a> , 
        	<a href="https://pasteboard.co/" target="_blank">pasteboard.co</a>
        </p>
        <p>Webs for file sharing: <br>
            <a href="https://wormhole.app/" target="_blank">wormhole</a> ,
            <a href="https://www.files2u.com" target="_blank">files2u</a> ,
            <a href="https://www.filedroper.com" target="_blank">filedroper</a> ,
            <a href="https://www.plustransfer.com/" target="_blank">plusTransfer</a> ,
            <a href="https://www.lifehack.org/articles/technology/20-online-file-sharing-tools-you-should-using.html" target="_blank">more</a>
        </p>
     </div>
    </div>

    <footer class="footer">
        <div class="container">
            <!--        <p class="text-muted">Place sticky footer content here.</p>-->
            <form action="">
                <input id="m" autocomplete="off" />
                <button>Send</button>
            </form>
        </div>
    </footer>


    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="https://v3.bootcss.com/assets/js/ie10-viewport-bug-workaround.js"></script>

    <!-- socket.io instant message -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <!-- <script src="https://code.jquery.com/jquery-1.11.1.js"></script> -->

    <script>
        var newMessageRemind = {
            _step: 0,
            _title: document.title,
            _timer: null,
            //显示新消息提示
            show: function () {
                var temps = newMessageRemind._title.replace("*           *", "").replace("*New Message*", "");
                newMessageRemind._timer = setTimeout(function () {
                    newMessageRemind.show();
                    //这里写Cookie操作
                    newMessageRemind._step++;
                    if (newMessageRemind._step == 3) {
                        newMessageRemind._step = 1
                    };
                    if (newMessageRemind._step == 1) {
                        document.title = "*           *" + temps
                    };
                    if (newMessageRemind._step == 2) {
                        document.title = "*New Message*" + temps
                    };
                }, 700);
                return [newMessageRemind._timer, newMessageRemind._title];
            },
            //取消新消息提示
            clear: function () {
                clearTimeout(newMessageRemind._timer);
                document.title = newMessageRemind._title;
                //这里写Cookie操作
            },
        };
    </script>

    <script>
        $(function () {
            var focusMrk = true;
            window.onblur = function () {
                focusMrk = false;
            }
            window.onfocus = function () {
                focusMrk = true;
            }
            document.onblur = window.onblur;
            document.focus = window.focus;

            //var socket 
            var socket = io();

            // ask username
            var username = prompt('输入您的昵称(随意):');
            socket.emit('new_username', username);  //send username to the server: socket.emit(event,data,[callback])

            // append text if someone is online
            socket.on('is online', function (online_info) {
                $('#messages').append($('<li>').html(online_info));
                // add();
                if (!focusMrk) {
                    newMessageRemind.show();
                }
            });

            // append text if receiving a new msg
            socket.on('chat message', function (msg1) {
                // $('#messages').append($('<li>').text(msg));
                $('#messages').append($('<li>').html(msg1));
                window.scrollTo(0, document.body.scrollHeight);
                if (!focusMrk) {
                    newMessageRemind.show();
                }
            });

            // submit text message without reload/refresh the page
            $('form').submit(function () {
                socket.emit('chat message', $('#m').val());  //upload message
                $('#m').val('');  //clear the input box
                newMessageRemind.clear();
                return false;
            });


            $(window).focus(function () {    //detect if window is active.
                newMessageRemind.clear();
            });
            // $(window).blur(function () {
                // clearInterval(interval_id);
                // interval_id = 0;
            // });
        });
    </script>

    <!-- add cursur focusing -->
    <script type="text/javascript">
    window.onload=function(){
        if(document.readyState=="complete"){
            document.getElementById("m").focus(); //激活的文本框ID
        }
    }
    </script>

</body>

</html>